import{_ as C,o as a,c as l,b as t,j as c,v as r,k as w,m as k,r as m,a as h,F as f,i as $,t as g}from"./index-ahOMgdsz.js";import{u as D}from"./toastStore-V2N45qjQ.js";import{m as L,D as V}from"./DelModal-wLUx1dDX.js";import{P}from"./PaginationComponent-mXp0pnoa.js";const R={props:["status","tempCoupons","updateData"],mixins:[L],data(){return{tempCouponsModal:{},due_date:""}},watch:{tempCoupons(){this.tempCouponsModal=this.tempCoupons;const o=new Date(this.tempCouponsModal.due_date*1e3).toISOString().split("T");[this.due_date]=o},due_date(){this.tempCouponsModal.due_date=Math.floor(new Date(this.due_date)/1e3)}}},T={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},E={class:"modal-dialog"},U={class:"modal-content"},S={key:0,class:"modal-header bg-primary"},A=t("h1",{class:"modal-title fs-5 text-white",id:"exampleModalLabel"},"新增優惠卷",-1),I=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),B=[A,I],j={key:1,class:"modal-header bg-warning"},O=t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"編輯優惠卷",-1),q=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),F=[O,q],H={class:"modal-body"},N={class:"mb-3"},z=t("label",{for:"title",class:"form-label"},"標題",-1),G={class:"mb-3"},J=t("label",{for:"coupon",class:"form-label"},"優惠碼",-1),K={class:"mb-3"},Q=t("label",{for:"date",class:"form-label"},"到期日",-1),W={class:"mb-3"},X=t("label",{for:"percent",class:"form-label"},"折扣百分比",-1),Y={class:"mb-2"},Z={class:"form-check"},tt=t("label",{for:"enabled",class:"form-check-label"}," 是否啟用 ",-1),et={class:"modal-footer"},st=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function ot(o,e,d,u,s,i){return a(),l("div",T,[t("div",E,[t("div",U,[d.status?(a(),l("div",S,B)):(a(),l("div",j,F)),t("div",H,[t("div",N,[z,c(t("input",{type:"text",class:"form-control",placeholder:"請輸入標題",id:"title","onUpdate:modelValue":e[0]||(e[0]=n=>s.tempCouponsModal.title=n)},null,512),[[r,s.tempCouponsModal.title]])]),t("div",G,[J,c(t("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼",id:"coupon","onUpdate:modelValue":e[1]||(e[1]=n=>s.tempCouponsModal.code=n)},null,512),[[r,s.tempCouponsModal.code]])]),t("div",K,[Q,c(t("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":e[2]||(e[2]=n=>s.due_date=n)},null,512),[[r,s.due_date]])]),t("div",W,[X,c(t("input",{type:"number",class:"form-control",id:"percent",min:"0",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[3]||(e[3]=n=>s.tempCouponsModal.percent=n)},null,512),[[r,s.tempCouponsModal.percent,void 0,{number:!0}]])]),t("div",Y,[t("div",Z,[c(t("input",{type:"checkbox",class:"form-check-input",id:"enabled","onUpdate:modelValue":e[4]||(e[4]=n=>s.tempCouponsModal.is_enabled=n),"true-value":1,"false-value":0},null,512),[[w,s.tempCouponsModal.is_enabled]]),tt])])]),t("div",et,[st,d.status?(a(),l("button",{key:0,type:"button",class:"btn btn-outline-primary",onClick:e[5]||(e[5]=n=>d.updateData(s.tempCouponsModal))},"新增優惠卷")):(a(),l("button",{key:1,type:"button",class:"btn btn-outline-warning",onClick:e[6]||(e[6]=n=>d.updateData(s.tempCouponsModal))},"編輯優惠卷"))])])])],512)}const nt=C(R,[["render",ot]]);var at={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"vuejs2024",BASE_URL:"/vite_week7_20240303/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:_,VITE_PATH:b}=at,lt={data(){return{isLoading:!1,remoteCoupons:[],tempCoupon:{title:"",is_enabled:0,percent:100,code:""},status:!1,pages:[]}},components:{CouponsModal:nt,DelModal:V,PaginationComponent:P},methods:{...k(D,["pushMessage"]),openModal(o,e){o==="new"?(this.tempCoupon={due_date:new Date().getTime()/1e3},this.status=!0,this.$refs.coupon.show()):o==="edit"?(this.tempCoupon={...e},this.status=!1,this.$refs.coupon.show()):o==="delete"&&(this.tempCoupon={...e},this.$refs.delModal.show())},updateData(o){this.tempCoupon=o;let e=`${_}/api/${b}/admin/coupon`,d="post";this.status||(e=`${_}/api/${b}/admin/coupon/${this.tempCoupon.id}`,d="put"),this.$http[d](e,{data:this.tempCoupon}).then(u=>{this.$refs.coupon.hide(),this.getRemoteCoupons(),this.pushMessage({style:"success",title:"優惠券狀態",content:u.data.message})}).catch(u=>{this.pushMessage({style:"danger",title:"優惠券狀態",content:u.response.data.message})})},getRemoteCoupons(o=1){this.isLoading=!0,this.$http(`${_}/api/${b}/admin/coupons?page=${o}`).then(e=>{this.remoteCoupons=e.data.coupons,this.pages=e.data.pagination,this.isLoading=!1}).catch(e=>{this.pushMessage({style:"danger",title:"取得優惠券",content:e.response.data.message})})},delCoupon(){this.isLoading=!0,this.$http.delete(`${_}/api/${b}/admin/coupon/${this.tempCoupon.id}`).then(o=>{this.isLoading=!1,this.pushMessage({style:"success",title:"優惠卷狀態",content:o.data.message}),this.$refs.delModal.hide(),this.getRemoteCoupons()}).catch(o=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"優惠卷狀態",content:o.response.data.message})})}},mounted(){this.getRemoteCoupons()}},dt={class:"container-fluid"},it={class:"p-5"},pt={class:"card"},ut={class:"card-body px-5 py-4"},ct={class:"d-flex justify-content-end mb-3"},rt={class:"table align-middle"},mt=t("thead",null,[t("tr",null,[t("th",{width:"250"},"名稱"),t("th",{width:"150"},"折扣百分比"),t("th",{width:"150"},"到期日"),t("th",{width:"100"},"是否啟用"),t("th",{width:"250",class:"text-center"},"編輯")])],-1),ht=t("td",null,"2024/2/27",-1),_t={key:0,class:"text-success"},bt={key:1,class:"text-danger"},ft={class:"text-center"},gt=["onClick"],Ct=["onClick"];function Mt(o,e,d,u,s,i){const n=m("VLoading"),M=m("PaginationComponent"),v=m("CouponsModal"),y=m("DelModal");return a(),l(f,null,[h(n,{active:s.isLoading},null,8,["active"]),t("div",dt,[t("div",it,[t("div",pt,[t("div",ut,[t("div",ct,[t("button",{class:"btn btn-primary fs-5 fw-bold",type:"button",onClick:e[0]||(e[0]=p=>i.openModal("new"))},"新增優惠卷")]),t("table",rt,[mt,t("tbody",null,[(a(!0),l(f,null,$(s.remoteCoupons,p=>(a(),l("tr",{key:p.id},[t("td",null,g(p.title),1),t("td",null,g(p.percent),1),ht,t("td",null,[p.is_enabled?(a(),l("span",_t,"啟用")):(a(),l("span",bt,"未啟用"))]),t("td",ft,[t("i",{class:"bi bi-pencil-square text-warning fs-2 fw-bold me-3",style:{cursor:"pointer"},onClick:x=>i.openModal("edit",p)},null,8,gt),t("i",{class:"bi bi-x-square text-danger fs-3 fw-bold",style:{cursor:"pointer"},onClick:x=>i.openModal("delete",p)},null,8,Ct)])]))),128))])]),h(M,{pages:s.pages,onChangePage:i.getRemoteCoupons,"get-products":i.getRemoteCoupons},null,8,["pages","onChangePage","get-products"])])])])]),h(v,{ref:"coupon",status:s.status,"temp-coupons":s.tempCoupon,"update-data":i.updateData},null,8,["status","temp-coupons","update-data"]),h(y,{ref:"delModal","temp-Product":s.tempCoupon,"del-Product":i.delCoupon},null,8,["temp-Product","del-Product"])],64)}const kt=C(lt,[["render",Mt]]);export{kt as default};
