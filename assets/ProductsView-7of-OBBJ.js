import{m as v,_ as y,o as d,c as i,b as t,j as r,v as u,F as P,i as w,g as V,k as C,r as h,a as _,t as f}from"./index-ahOMgdsz.js";import{u as x}from"./toastStore-V2N45qjQ.js";import{m as E,D}from"./DelModal-wLUx1dDX.js";import{P as L}from"./PaginationComponent-mXp0pnoa.js";var T={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"vuejs2024",BASE_URL:"/vite_week7_20240303/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:N,VITE_PATH:R}=T,A={props:["isNew","tempProduct","updateProduct"],mixins:[E],data(){return{tempProductModal:{}}},watch:{tempProduct(){this.tempProductModal=this.tempProduct}},methods:{...v(x,["pushMessage"]),updateFile(){const l=this.$refs.fileInput.files[0],e=new FormData;e.append("file-to-upload",l),this.$http.post(`${N}/api/${R}/admin/upload`,e).then(n=>{this.tempProductModal.imageUrl=n.data.imageUrl,this.$refs.fileInput.value="",this.pushMessage({style:"success",title:"圖片上傳成功",content:n.data.message})}).catch(n=>{this.pushMessage({style:"danger",title:"圖片上傳失敗",content:n.response.data.message})})}}},F={class:"modal fade",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog modal-xl"},j={class:"modal-content"},I={key:0,class:"modal-header bg-primary"},B=t("h1",{class:"modal-title fs-5 text-white fw-bold",id:"exampleModalLabel"}," 新增產品",-1),H=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),$=[B,H],O={key:1,class:"modal-header bg-warning"},q=t("h1",{class:"modal-title fs-5 fw-bold",id:"exampleModalLabel"},"編輯產品",-1),z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),G=[q,z],J={class:"modal-body"},K={class:"row"},Q={class:"col-md-4"},W={class:"mb-3"},X=t("label",{for:"majorPhoto",class:"form-label fw-bold fs-5"},"主要圖片",-1),Y={class:"mb-3"},Z=t("label",{for:"updateFile",class:"form-label fw-bold fs-5"}," 或 上傳圖片 ",-1),tt=["src","alt"],et={class:"my-4"},ot=t("div",{class:"card-title fw-bold fs-5"}," 多圖新增 ",-1),st={key:0},lt=["onUpdate:modelValue"],dt=["src","alt"],it={class:"col-md-8"},nt={class:"mb-3"},at=t("label",{for:"title",class:"form-label fw-bold fs-5"}," 標題 ",-1),rt={class:"mb-4"},ct={class:"row g-3"},ut={class:"col-md-6"},pt=t("label",{for:"category",class:"form-label fw-bold fs-5"},"分類",-1),mt={class:"col-md-6"},ht=t("label",{for:"unit",class:"form-label fw-bold fs-5"},"單位",-1),_t={class:"col-md-6"},ft=t("label",{for:"originPrice",class:"form-label fw-bold fs-5"},"原價",-1),bt={class:"col-md-6"},gt=t("label",{for:"price",class:"form-label fw-bold fs-5"},"售價",-1),Pt=t("div",{class:"my-3"},[t("hr")],-1),Mt={class:"mb-3"},vt=t("label",{for:"description",class:"form-label fw-bold fs-5"},"產品描述",-1),yt={class:"mb-3"},wt=t("label",{for:"content",class:"form-label fw-bold fs-5"},"產品內容",-1),xt={class:"mb-3"},Ut={class:"form-check"},kt=t("label",{for:"isEnabled",class:"form-check-label fw-bold"},"是否啟用",-1),Vt={class:"modal-footer"},Ct=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消",-1);function Et(l,e,n,p,o,a){return d(),i("div",F,[t("div",S,[t("div",j,[n.isNew?(d(),i("div",I,$)):(d(),i("div",O,G)),t("div",J,[t("div",K,[t("div",Q,[t("div",W,[X,r(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片網址",id:"majorPhoto","onUpdate:modelValue":e[0]||(e[0]=s=>o.tempProductModal.imageUrl=s)},null,512),[[u,o.tempProductModal.imageUrl]])]),t("div",Y,[Z,t("input",{type:"file",class:"form-control",id:"updateFile",ref:"fileInput",onChange:e[1]||(e[1]=(...s)=>a.updateFile&&a.updateFile(...s))},null,544),t("img",{src:o.tempProductModal.imageUrl,alt:o.tempProductModal.title,class:"img-fluid mt-3"},null,8,tt)]),t("div",et,[ot,Array.isArray(o.tempProductModal.imagesUrl)?(d(),i("div",st,[(d(!0),i(P,null,w(o.tempProductModal.imagesUrl,(s,m)=>(d(),i(P,{key:s},[r(t("input",{type:"text",class:"form-control mb-2",placeholder:"請輸入圖片網址","onUpdate:modelValue":M=>o.tempProductModal.imagesUrl[m]=M},null,8,lt),[[u,o.tempProductModal.imagesUrl[m]]]),t("img",{src:s,alt:o.tempProductModal.title,class:"img-fluid mb-3"},null,8,dt)],64))),128)),!o.tempProductModal.imagesUrl.length||o.tempProductModal.imagesUrl[o.tempProductModal.imagesUrl.length-1]?(d(),i("button",{key:0,class:"btn btn-outline-primary w-100 fw-bold",type:"button",onClick:e[2]||(e[2]=s=>o.tempProductModal.imagesUrl.push(""))},"新增圖片")):(d(),i("button",{key:1,class:"btn btn-outline-danger w-100 fw-bold",type:"button",onClick:e[3]||(e[3]=s=>o.tempProductModal.imagesUrl.pop())},"刪除圖片"))])):V("",!0)])]),t("div",it,[t("div",nt,[at,r(t("input",{type:"text",class:"form-control",placeholder:"必填標題",id:"title","onUpdate:modelValue":e[4]||(e[4]=s=>o.tempProductModal.title=s)},null,512),[[u,o.tempProductModal.title]])]),t("div",rt,[t("div",ct,[t("div",ut,[pt,r(t("input",{type:"text",class:"form-control",placeholder:"必填分類",id:"category","onUpdate:modelValue":e[5]||(e[5]=s=>o.tempProductModal.category=s)},null,512),[[u,o.tempProductModal.category]])]),t("div",mt,[ht,r(t("input",{type:"text",class:"form-control",placeholder:"必填單位",id:"unit","onUpdate:modelValue":e[6]||(e[6]=s=>o.tempProductModal.unit=s)},null,512),[[u,o.tempProductModal.unit]])]),t("div",_t,[ft,r(t("input",{type:"number",class:"form-control",placeholder:"必填原價",id:"originPrice",min:"0","onUpdate:modelValue":e[7]||(e[7]=s=>o.tempProductModal.origin_price=s)},null,512),[[u,o.tempProductModal.origin_price,void 0,{number:!0}]])]),t("div",bt,[gt,r(t("input",{type:"number",class:"form-control",placeholder:"必填售價",id:"price",min:"0","onUpdate:modelValue":e[8]||(e[8]=s=>o.tempProductModal.price=s)},null,512),[[u,o.tempProductModal.price,void 0,{number:!0}]])])])]),Pt,t("div",Mt,[vt,r(t("textarea",{id:"description",rows:"2",class:"form-control","onUpdate:modelValue":e[9]||(e[9]=s=>o.tempProductModal.description=s)},null,512),[[u,o.tempProductModal.description]])]),t("div",yt,[wt,r(t("textarea",{id:"content",rows:"2",class:"form-control","onUpdate:modelValue":e[10]||(e[10]=s=>o.tempProductModal.content=s)},null,512),[[u,o.tempProductModal.content]])]),t("div",xt,[t("div",Ut,[r(t("input",{type:"checkbox",class:"form-check-input",id:"isEnabled","onUpdate:modelValue":e[11]||(e[11]=s=>o.tempProductModal.is_enabled=s),"true-value":1,"false-value":0},null,512),[[C,o.tempProductModal.is_enabled]]),kt])])])])]),t("div",Vt,[Ct,n.isNew?(d(),i("button",{key:0,type:"button",class:"btn btn-primary fw-bold",onClick:e[12]||(e[12]=s=>n.updateProduct(o.tempProductModal))},"新增確認")):(d(),i("button",{key:1,type:"button",class:"btn btn-warning fw-bold",onClick:e[13]||(e[13]=s=>n.updateProduct(o.tempProductModal))},"編輯確認"))])])])],512)}const Dt=y(A,[["render",Et]]);var Lt={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"vuejs2024",BASE_URL:"/vite_week7_20240303/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:b,VITE_PATH:g}=Lt,Tt={data(){return{isLoading:!1,isNew:!1,remoteData:[],tempProduct:{},pages:{}}},components:{ProductModal:Dt,DelModal:D,PaginationComponent:L},methods:{...v(x,["pushMessage"]),getProducts(l=1){this.isLoading=!0,this.$http(`${b}/api/${g}/admin/products/?page=${l}`).then(e=>{this.pushMessage({style:"success",title:"成功取得產品資訊",content:e.data.message}),this.isLoading=!1,this.remoteData=e.data.products,this.pages=e.data.pagination}).catch(e=>{alert("未取得",e.response.data.message)})},openModal(l,e){l==="new"?(this.tempProduct={imagesUrl:[]},this.$refs.pModal.show(),this.isNew=!0):l==="edit"?(this.tempProduct={...e},this.$refs.pModal.show(),this.isNew=!1):l==="delete"&&(this.tempProduct={...e},this.$refs.delModal.show())},updateProduct(l){this.tempProduct=l;let e=`${b}/api/${g}/admin/product`,n="post",p="新增產品";this.isNew||(e=`${b}/api/${g}/admin/product/${this.tempProduct.id}`,n="put",p="更新產品"),this.$http[n](e,{data:this.tempProduct}).then(o=>{this.pushMessage({style:"success",title:p,content:o.data.message}),this.$refs.pModal.hide(),this.getProducts()}).catch(o=>{this.pushMessage({style:"success",title:p,content:o.response.data.message})})},delProduct(){this.$http.delete(`${b}/api/${g}/admin/product/${this.tempProduct.id}`).then(l=>{this.pushMessage({style:"success",title:"刪除產品",content:l.data.message}),this.$refs.delModal.hide(),this.getProducts()}).catch(l=>{this.pushMessage({style:"danger",title:"刪除產品",content:l.response.data.message})})}},mounted(){this.getProducts()}},Nt={class:"container-fluid"},Rt={class:"p-5"},At={class:"card"},Ft={class:"card-body px-5 py-4"},St={class:"d-flex justify-content-end mb-3"},jt={class:"table align-middle"},It=t("thead",null,[t("tr",null,[t("th",{width:"250"},"分類"),t("th",null,"產品名稱"),t("th",{width:"150"},"原價"),t("th",{width:"150"},"售價"),t("th",{width:"150"},"是否啟用"),t("th",{width:"150",class:"text-center"},"編輯")])],-1),Bt={key:0,class:"text-success"},Ht={key:1,class:"text-danger"},$t={class:"text-center"},Ot=["onClick"],qt=["onClick"];function zt(l,e,n,p,o,a){const s=h("VLoading"),m=h("PaginationComponent"),M=h("ProductModal"),U=h("DelModal");return d(),i(P,null,[_(s,{active:o.isLoading},null,8,["active"]),t("div",Nt,[t("div",Rt,[t("div",At,[t("div",Ft,[t("div",St,[t("button",{class:"btn btn-primary fs-5 fw-bold",type:"button",onClick:e[0]||(e[0]=c=>a.openModal("new"))},"新增產品")]),t("table",jt,[It,t("tbody",null,[(d(!0),i(P,null,w(o.remoteData,c=>(d(),i("tr",{key:c.id},[t("th",null,f(c.category),1),t("th",null,f(c.title),1),t("td",null,f(c.origin_price),1),t("td",null,f(c.price),1),t("td",null,[c.is_enabled?(d(),i("span",Bt,"啟用")):(d(),i("span",Ht,"未啟用"))]),t("td",$t,[t("i",{class:"bi bi-pencil-square text-warning fs-2 fw-bold me-3",style:{cursor:"pointer"},onClick:k=>a.openModal("edit",c)},null,8,Ot),t("i",{class:"bi bi-x-square text-danger fs-3 fw-bold",style:{cursor:"pointer"},onClick:k=>a.openModal("delete",c)},null,8,qt)])]))),128))])]),_(m,{pages:o.pages,onChangePage:a.getProducts,"get-products":a.getProducts},null,8,["pages","onChangePage","get-products"])])])])]),_(M,{ref:"pModal","is-new":o.isNew,"temp-product":o.tempProduct,"update-product":a.updateProduct},null,8,["is-new","temp-product","update-product"]),_(U,{ref:"delModal","temp-product":o.tempProduct,"del-product":a.delProduct},null,8,["temp-product","del-product"])],64)}const Wt=y(Tt,[["render",zt]]);export{Wt as default};
