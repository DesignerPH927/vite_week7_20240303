import{_ as U,m as D,r as b,o as i,c as l,a as d,b as t,F as y,i as C,t as u,g as v,j as L,v as k,e as w,w as V,q as x,n as f}from"./index-ahOMgdsz.js";import{u as q}from"./toastStore-V2N45qjQ.js";var E={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"vuejs2024",BASE_URL:"/vite_week7_20240303/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:h,VITE_PATH:_}=E,$={data(){return{isLoading:!1,remoteData:[],tempProduct:{},carts:[],status:{addToCartLoading:"",delCartLoading:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},coupon_code:""}},methods:{...D(q,["pushMessage"]),getRemoteData(){this.isLoading=!0,this.$http(`${h}/api/${_}/products/all`).then(o=>{this.isLoading=!1,this.remoteData=o.data.products}).catch(o=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得產品資訊失敗",content:o.response.data.message})})},getProduct(o){this.$router.push(`/user/product/${o}`)},addToCart(o,e=1){this.isLoading=!0;const g={product_id:o.id,qty:e};this.status.addToCartLoading=o.id,this.$http.post(`${h}/api/${_}/cart`,{data:g}).then(c=>{this.isLoading=!1,this.status.addToCartLoading="",this.pushMessage({style:"success",title:"成功加入購物車",content:c.data.message}),this.getCarts()}).catch(c=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"加入購物車失敗",content:c.response.data.message})})},getCarts(){this.isLoading=!0,this.$http(`${h}/api/${_}/cart`).then(o=>{this.isLoading=!1,this.carts=o.data.data}).catch(o=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得購物車資訊",content:o.response.data.message})})},changeQty(o,e=1){this.isLoading=!0;const g={product_id:o.product_id,qty:e};this.$http.put(`${h}/api/${_}/cart/${o.id}`,{data:g}).then(c=>{this.isLoading=!1,this.pushMessage({style:"success",title:"更新購物車",content:c.data.message}),this.getCarts()}).catch(c=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"更新購物車",content:c.response.data.message})})},delCart(o){this.isLoading=!0,this.$http.delete(`${h}/api/${_}/cart/${o}`).then(e=>{this.isLoading=!1,this.getCarts(),this.pushMessage({style:"success",title:"移除購物車品項",content:e.data.message})}).catch(e=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"移除購物車品項",content:e.response.data.message})})},delCarts(){this.isLoading=!0,this.status.delCartLoading=this.carts,this.$http.delete(`${h}/api/${_}/carts`).then(o=>{this.isLoading=!1,this.status.delCartLoading="",this.getCarts(),this.pushMessage({style:"success",title:"清除購物車",content:o.data.message})}).catch(o=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"清除購物車",content:o.response.data.message})})},addCouponCode(){const o={code:this.coupon_code};this.isLoading=!0,this.$http.post(`${h}/api/${_}/coupon`,{data:o}).then(e=>{this.isLoading=!1,this.pushMessage({style:"success",title:"加入優惠券",content:e.data.message})}).catch(e=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"加入優惠券",content:e.response.data.message})})},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"需要正確的電話號碼"},onSubmit(){this.isLoading=!0;const o=this.form;this.$http.post(`${h}/api/${_}/order`,{data:o}).then(e=>{this.isLoading=!1,this.$refs.form.resetForm(),this.$router.push(`/user/check/${e.data.orderId}`)}).catch(e=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"建立訂單",content:e.response.data.message})})}},mounted(){this.getRemoteData(),this.getCarts()}},S={class:"container-fluid"},N={class:"py-5"},P={class:"card py-5 px-3"},A={class:"card-body"},F={class:"row"},R={class:"col-md-7"},j={class:"table align-middle text-center"},z=t("thead",null,[t("tr",null,[t("th",null,"商品圖片"),t("th",null,"商品名稱"),t("th",null,"商品價格"),t("th",null,"商品選項")])],-1),B={style:{width:"150px"}},Q={class:"fw-bold"},H={key:0},O={class:"mb-0 fw-bold"},G={key:1},J={class:"mb-0 text-muted"},K={class:"mb-0 fw-bold"},W={class:"d-flex justify-content-center"},X=["onClick"],Y=["onClick"],Z={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},I={class:"col-md-5"},tt={class:"table align-middle text-center"},st=t("thead",null,[t("tr",null,[t("th",{width:"100"},"商品圖"),t("th",{width:"120"},"品名"),t("th",null,"數量"),t("th",{width:"120"},"單價")])],-1),et={style:{width:"60px"}},ot={class:"d-flex flex-nowrap justify-content-center"},at=["onClick"],nt=t("i",{class:"bi bi-dash-lg"},null,-1),it=[nt],lt=["onClick"],dt=t("i",{class:"bi bi-trash-fill"},null,-1),rt=[dt],ct=["onUpdate:modelValue"],ut=["onClick"],ht=t("i",{class:"bi bi-plus-lg"},null,-1),_t=[ht],pt={class:"text-end"},mt={class:"text-end fw-bold"},gt=t("td",{colspan:"3"},"總價",-1),bt={colspan:"4"},ft={key:0,class:"text-success text-end fw-bold"},yt=t("td",{colspan:"3"},"優惠價",-1),vt={colspan:"4"},Ct={class:"row"},Lt={class:"col-6"},kt={class:"input-group mb-3 input-group-sm"},wt={class:"input-group-append"},Vt={class:"col-6"},xt={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},Mt=t("div",{class:"my-5"},[t("hr")],-1),Tt={class:"mx-auto",style:{width:"500px"}},Ut=t("h3",{class:"fw-bold text-center"}," 請填寫表單 ",-1),Dt={class:"mb-3"},qt=t("label",{for:"mail",class:"form-label fw-bold"}," 信箱 ",-1),Et={class:"mb-3"},$t=t("label",{for:"name",class:"form-label fw-bold"}," 姓名 ",-1),St={class:"mb-3"},Nt=t("label",{for:"tel",class:"form-label fw-bold"}," 電話 ",-1),Pt={class:"mb-3"},At=t("label",{for:"address",class:"form-label fw-bold"}," 地址 ",-1),Ft=t("option",{value:"",selected:"",disabled:""},"請選擇地區",-1),Rt=t("option",{value:"台北市"},"台北市",-1),jt=t("option",{value:"新北市"},"新北市",-1),zt=t("option",{value:"桃園市"},"桃園市",-1),Bt=t("option",{value:"新竹市"},"新竹市",-1),Qt=t("option",{value:"台中市"},"台中市",-1),Ht={class:"mb-3"},Ot=t("label",{for:"message",class:"form-label fw-bold"}," 留言 ",-1),Gt=t("div",{class:"mb-3"},[t("div",{class:"d-flex gap-2 justify-content-end"},[t("button",{class:"btn btn-outline-secondary w-25",type:"button"},"取消"),t("button",{class:"btn btn-primary w-25",type:"submit"},"送出")])],-1);function Jt(o,e,g,c,a,r){const M=b("VLoading"),p=b("VField"),m=b("error-message"),T=b("VForm");return i(),l(y,null,[d(M,{active:a.isLoading},null,8,["active"]),t("div",S,[t("div",N,[t("div",P,[t("div",A,[t("div",F,[t("div",R,[t("table",j,[z,t("tbody",null,[(i(!0),l(y,null,C(a.remoteData,s=>(i(),l("tr",{key:s.id},[t("td",B,[t("div",{style:x([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s.imageUrl})`}])},null,4)]),t("td",Q,u(s.title),1),t("td",null,[s.origin_price==s.price?(i(),l("div",H,[t("p",O," 原價"+u(s.origin_price)+"元 ",1)])):(i(),l("div",G,[t("del",J," 原價"+u(s.origin_price)+"元 ",1),t("p",K," 現在只要"+u(s.price)+"元 ",1)]))]),t("td",null,[t("div",W,[t("button",{class:"btn fw-bold btn-outline-success",type:"button",onClick:n=>r.getProduct(s.id)},"查看更多",8,X),t("button",{class:"btn fw-bold btn-outline-primary",type:"button",onClick:n=>r.addToCart(s)},[s.id===a.status.addToCartLoading?(i(),l("span",Z)):v("",!0),w(" 加入購物車")],8,Y)])])]))),128))])])]),t("div",I,[t("table",tt,[st,t("tbody",null,[(i(!0),l(y,null,C(a.carts.carts,s=>(i(),l("tr",{key:s.id},[t("td",et,[t("div",{style:x([{height:"60px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s.product.imageUrl})`}])},null,4)]),t("td",null,u(s.product.title),1),t("td",null,[t("div",ot,[s.qty>1?(i(),l("button",{key:0,class:"btn btn-outline-primary shadow-none",type:"button",onClick:n=>{s.qty--,r.changeQty(s,s.qty)}},it,8,at)):(i(),l("button",{key:1,class:"btn btn-outline-danger shadow-none",type:"button",onClick:n=>r.delCart(s.id)},rt,8,lt)),L(t("input",{type:"number",class:"form-control bg-transparent shadow-none text-center text-end",readonly:"","onUpdate:modelValue":n=>s.qty=n},null,8,ct),[[k,s.qty]]),t("button",{class:"btn btn-outline-primary shadow-none",type:"button",onClick:n=>{s.qty++,r.changeQty(s,s.qty)}},_t,8,ut)])]),t("td",pt," $"+u(s.total),1)]))),128))]),t("tfoot",null,[t("tr",mt,[gt,t("td",bt,u(a.carts.total)+"元",1)]),a.carts.final_total!==a.carts.total?(i(),l("tr",ft,[yt,t("td",vt,u(a.carts.final_total)+"元",1)])):v("",!0)])]),t("div",Ct,[t("div",Lt,[t("div",kt,[L(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=s=>a.coupon_code=s),placeholder:"請輸入優惠碼"},null,512),[[k,a.coupon_code]]),t("div",wt,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[1]||(e[1]=(...s)=>r.addCouponCode&&r.addCouponCode(...s))}," 套用優惠碼 ")])])]),t("div",Vt,[t("button",{class:"btn ms-auto btn-outline-danger d-block",type:"button",onClick:e[2]||(e[2]=(...s)=>r.delCarts&&r.delCarts(...s))},[a.carts===a.status.delCartLoading?(i(),l("span",xt)):v("",!0),w(" 刪除全品項 ")])])])])]),Mt,t("div",Tt,[Ut,d(T,{action:"#",onSubmit:r.onSubmit,ref:"form"},{default:V(({errors:s})=>[t("div",Dt,[qt,d(p,{id:"mail",type:"mail",name:"Email",class:f(["form-control",{"is-invalid":s.Email}]),placeholder:"請輸入信箱",rules:"email|required",modelValue:a.form.user.email,"onUpdate:modelValue":e[3]||(e[3]=n=>a.form.user.email=n)},null,8,["modelValue","class"]),d(m,{name:"Email",class:"invalid-feedback"})]),t("div",Et,[$t,d(p,{id:"name",type:"text",name:"Name",class:f(["form-control",{"is-invalid":s.Name}]),rules:"required",modelValue:a.form.user.name,"onUpdate:modelValue":e[4]||(e[4]=n=>a.form.user.name=n),placeholder:"請輸入姓名"},null,8,["modelValue","class"]),d(m,{name:"Name",class:"invalid-feedback"})]),t("div",St,[Nt,d(p,{id:"tel",type:"tel",name:"Telephone",class:f(["form-control",{"is-invalid":s.Telephone}]),rules:r.isPhone,modelValue:a.form.user.tel,"onUpdate:modelValue":e[5]||(e[5]=n=>a.form.user.tel=n),placeholder:"請輸入電話"},null,8,["rules","modelValue","class"]),d(m,{name:"Telephone",class:"invalid-feedback"})]),t("div",Pt,[At,d(p,{id:"address",name:"Area",class:f(["form-control",{"is-invalid":s.Area}]),placeholder:"請輸入地區",rules:"required",modelValue:a.form.user.address,"onUpdate:modelValue":e[6]||(e[6]=n=>a.form.user.address=n),as:"select"},{default:V(()=>[Ft,Rt,jt,zt,Bt,Qt]),_:2},1032,["class","modelValue"]),d(m,{name:"Area",class:"invalid-feedback"})]),t("div",Ht,[Ot,d(p,{id:"message",rows:"10",name:"Message",class:"form-control",modelValue:a.form.user.message,"onUpdate:modelValue":e[7]||(e[7]=n=>a.form.user.message=n),as:"textarea"},null,8,["modelValue"]),d(m,{name:"Message",class:"invalid-feedback"})]),Gt]),_:1},8,["onSubmit"])])])])])])],64)}const Xt=U($,[["render",Jt]]);export{Xt as default};
